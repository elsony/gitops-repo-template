# GitOps Repository Template

This is an example of what the AppStudio GitOps repository might look like for a simple application. This example contains one component ('basic-node-js').

In particular:
- The GitOps repository can contain multiple components (for example, the 'frontend' and 'backend' of a single application.)
- There is currently no environment specific configuration

## Resources

There are two types of resources defined in this repository:
- **Components**: 
    - A component contains one or more Kubernetes resources (Deployments/ConfigMaps/etc), representing a component of an application to deploy.
    - For example, the 'frontend' and 'backend' of a single application (both would be components, here)
    - Component resources may be customized (by kustomize) based on the environment they are targeting, for example, different environment variables in staging/production containing different database service credentials.

## Primary Kustomize Entrypoints

The root contains a single `kustomization.yaml` as a single entrypoint to link to all containing components. The full contents of the GitOps repository can be generated by calling `kustomize build` at the root to deploy.
Note: In the future, there will be environment specific configuration stored under individual environment overlays folders under a given component.

For example:
- `kustomize build .`: To generate the environment dev K8s resources, including all referenced components (eg component A/B/...)

## Tree Diagram

Here is the hierarchy of resources within the repository:

```
.
├── kustomization.yaml
├── common-storage-pvc.yaml
└── components
    ├── componentA
    │   └── base
    │       ├── deployment-sample-workload.yaml
    │       ├── kustomization.yaml
    │       ├── route-sample-workload.yaml
    │       └── service-sample-workload.yaml
    └── componentB
    │    └── base
    │       ├── deployment-sample-workload.yaml
    │       ├── kustomization.yaml
    │       ├── route-sample-workload.yaml
    │       └── service-sample-workload.yaml
```


## Try it out

#### Prerequisites:
- Ensure you have `kustomize` installed, and that `kubectl` is pointing to a valid *OpenShift* cluster.

You can try it out by running the following commands:
```bash
# Dev Environment -------------------------------------------------------------

# Create the target namespace
kubectl create namespace my-environment

# Output the K8s resources that will be applied for the environment
kustomize build .

# Apply the resources (then wait a moment)
kustomize build . | kubectl apply -n my-environment -f -

# Retrieve the routes of the components
kubectl get routes

# You should now be able to access the Route, and see the environments variables output by that Route.
```

